
https://losst.pro/nastrojka-ufw-ubuntu?ysclid=lqo3yfyzdx438932467
https://setiwik.ru/kak-nastroit-brandmauer-ufw-na-ubuntu-22-04/

----------Синтаксис команд------
$ ufw опции действие параметры

----------Опции-----------------
  --version--version - вывести версию брандмауэра;
  --dry-run - тестовый запуск, никакие реальные действия не выполняются.

----------Команды---------------
enable - включить фаерволл и добавить его в автозагрузку;
disable - отключить фаерволл и удалить его из автозагрузки;
reload - перезагрузить файервол;
default - задать политику по умолчанию, доступно allow, deny и reject, а также три вида трафика - incoming, outgoing или routed;
logging - включить журналирование или изменить уровень подробности;
reset - сбросить все настройки до состояния по умолчанию;
status - посмотреть состояние фаервола;
show - посмотреть один из отчётов о работе;
allow - добавить разрешающее правило;
deny - добавить запрещающее правило;
reject - добавить отбрасывающее правило;
limit - добавить лимитирующее правило;
delete - удалить правило;
insert - вставить правило.

----------Install UFW-----------
sudo apt update
sudo apt install ufw

----------Политика по умолчанию-----------
cat /etc/default/ufw - просмотр политики

----------Defalt value----------
sudo ufw default deny incoming - Все входящие пакеты будем отклонять:
sudo ufw default allow outgoing -  все исходящие разрешим

---------Status----------------
sudo ufw status

----------------------------------------------------------------------
Обратите внимание, что если вы работаете по SSH, то перед тем, как 
включать брандмауэр, нужно добавить правило, разрешающее работу по SSH, 
иначе у вас не будет доступа к серверу. 
----------------------------------------------------------------------

---------Проверка состояния UFW-
sudo ufw show added
sudo ufw status verbose

---------Добавление правил-----------
По умолчанию все запрещено, выше были команды для 
разрешения всех исходящих соединений и отклонения 
всех входящих соединений, но так же нужно разрешить 
входящеие для отдельных приложений: GIT, Jenkins, SSH etc.
----------------------------------------------------------------------
Обратите внимание, что если вы работаете по SSH, то перед тем, как 
включать брандмауэр, нужно добавить правило, разрешающее работу по SSH, 
иначе у вас не будет доступа к серверу. 
----------------------------------------------------------------------


---------Добавление правил-----------
sudo ufw allow OpenSSH - разрешают входящие и исходящие подключения к порту 22 для любого протокола
sudo ufw allow 22 - разрешают входящие и исходящие подключения к порту 22 для любого протокола
sudo ufw allow ssh - разрешают входящие и исходящие подключения к порту 22 для любого протокола
sudo ufw app list - Посмотреть доступные имена приложений

Можно также указать направление следования трафика с помощью слов out для исходящего и in для входящего.

ufw allow направление порт - синтаксис команд

sudo ufw allow out 80/tcp - разрешение исходящего трафика на порт 80
sudo ufw deny in 80/tcp - запрет входящего трафика на порт 80

------------------------------------------------------------------------

Также можно использовать более полный синтаксис добавления правил:

$ ufw allow proto протокол from ip_источника to ip_назначения port порт_назначения

В качестве ip_источника может использоваться также и адрес подсети. Например, разрешим доступ со всех IP-адресов для интерфейса eth0 по протоколу tcp к нашему IP-адресу и порту 3318:

sudo ufw allow proto tcp from 0.0.0.0/24 to 192.168.1.5 port 3318

-------------------- Правила limit ufw ------------------------
С помощью правил limit можно ограничить количество подключений к определённому порту с одного IP-адреса, это может быть полезно для защиты от атак перебора паролей. По умолчанию подключения блокируются, если пользователь пытается создать шесть и больше подключений за 30 секунд:

sudo ufw limit ssh/tcp



--------- Включение UFW ------------
sudo ufw enable


--------- Отчеты --------------------------------------------------

С помощью команды show можно посмотреть разные отчеты:

raw - все активные правила в формате iptables;
builtins - правила, добавленные по умолчанию;
before-rules - правила, которые выполняются перед принятием пакета;
user-rules - правила, добавленные пользователем;
after-rules - правила, которые выполняются после принятия пакета;
logging-rules - правила логгирования пакетов;
listening - отображает все прослушиваемые порты и правила для них;
added - недавно добавленные правила;


--------- Удаление правил ufw ---------------------------
Чтобы удалить правило ufw, используется команда delete. 
Например, удалим ранее созданные правила для порта 80:

sudo ufw delete allow out 80/tcp

sudo ufw delete deny in 80/tcp

---------- Отключение UFW -----------------------------------------------------------------
Если вы хотите полностью отключить UFW, для этого достаточно использовать команду disable:

sudo ufw disable

Также, если вы что-то испортили в настройках и не знаете как исправить, можно использовать команду reset для сброса настроек до состояния по умолчанию:

sudo ufw reset


---------- Конфигурационный файл ------------------------
sudo vim /etc/default/ufw















